---
- hosts: all
  tasks:
    - name: create certificate directory
      file:
        path: /etc/nginx/ssl/
        state: directory
        mode: '0700'

    - name: copy certificate from environment variable
      copy:
        content: "{{ lookup('env','CERTIFICATE') }}"
        dest: /etc/nginx/ssl/blog.hackervaillant.eu.crt

    - name: copy private key from environment variable
      copy:
        content: "{{ lookup('env','PRIVATE_KEY') }}"
        dest: /etc/nginx/ssl/blog.hackervaillant.eu.key

    - name: include nginx role
      include_role:
        name: nginx

    - name: copy blog
      copy:
        src: public
        dest: /var/www/blog.hackervaillant.eu/
